<!DOCTYPE html>
<html>

<head>
    <style type="text/css">
        .header {
            text-align: center;
            font-size: 75px;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            /* background-color: #fefefe; */
            background-color: #3eec95;

            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;

        }

        .modal-content-wrong {
            /* background-color: #fefefe; */
            background-color: #ff745f;

            margin: 15% auto;
            padding: 20px;
            /* border: 1px solid #888; */
            width: 80%;

        }

        .modal-content .header {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 50%;
        }

        .modal-content-wrong .header {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 50%;
        }

        .modal-content .header img {
            height: 400px;
        }

        .modal-content-wrong .header img {
            height: 400px;
        }

        .modal-content .body {
            padding-right: 5%;
            padding-left: 5%;

        }

        .modal-content-wrong .body {
            padding-right: 5%;
            padding-left: 5%;

        }

        .modal-content .body button {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 50%;
            padding: 20px;
            margin-bottom: 20px;
        }

        .modal-content-wrong .body button {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 50%;
            padding: 20px;
            margin-bottom: 20px;
        }

        .modal-content .header p {
            margin-top: -30px;
            font-size: 45px;
        }

        .modal-content-wrong .header p {
            margin-top: -30px;
            font-size: 45px;
        }

        .modal-content p {
            font-size: 45px;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .modal-content-wrong p {
            font-size: 45px;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .modal-content td {
            font-size: 45px;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .modal-content-wrong td {
            font-size: 45px;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .modal-content h1 {
            font-size: 45px;
            color: red;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .modal-content-wrong h1 {
            font-size: 45px;
            color: red;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .modal-content button {
            background-color: #fff;
            border: none;
            color: #000;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 40px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 25px;
            padding: 20px;

        }

        .modal-content-wrong button {
            background-color: #fff;
            border: none;
            color: #000;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 40px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 25px;
            padding: 20px;

        }

        .close {
            color: #aaa;
            float: right;
            font-size: 50px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

     
    </style>
</head>

<body>
    <h2 class="header">Covid-19 QR Scanner</h2>
    <div id="reader" width="300px"></div>
    <div id='add_to_me'></div>

    <!-- The Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <div id="myModalcont"></div>
        </div>
        <div class="modal-content-wrong"></span>
            <div id="myModalcontWrong"></div>
        </div>
    </div>
</body>


</html>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script type="text/javascript">
    const html5QrCode = new Html5Qrcode(/* element id */ "reader");
    html5QrCode.start(
        { facingMode: "environment" },
        {
            fps: 10,    // Optional, frame per seconds for qr code scanning
            qrbox: { width: 600, height: 600 }  // Optional, if you want bounded box UI
        },
        (decodedText, decodedResult) => {
            var song = new Audio();
            song.src = 'https://team13.app.sr/beep.mp3';
            song.play();
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            decodedText = "eyJpdiI6IlJ3WWVuU2xlMUM4aEMzZk5GaUNlL3c9PSIsInZhbHVlIjoiRG92dHkrS1RBN08waDFlTXowN24vZz09IiwibWFjIjoiMDBiYWQ1M2Y3MzRkYTAzNTNiN2VhMTBiMDFlNDE0MmNlMDE1NWRmZjEwNGE1MmFhYjI1MDBiYTdmN2RhNGUyNCIsInRhZyI6IiJ9"
            var raw = JSON.stringify({ "id": decodedText });
            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };
            fetch("http://127.0.0.1:8000/api/qrscanner", requestOptions)
                .then(response => response.text())
                .then(result => {
                    var res = JSON.parse(result);
                    console.log(res)
                    modal.style.display = "block";
                    console.log(res[0]['status'])

                    if (res[0]['status'] == 'afgehandeld') {
                        //pcr
                    } else {
                        //vax
                        if (res[0].status == '1e Dose') {
                            vacStatus = "Eerste prik gevaccineerd"
                            document.getElementById('myModalcont').innerHTML = ' <div class="img"><img src="wrong.png"></div><table><tr><td><b>Voornaam:</b></td><td> ' + res[0].first_name + '</td></tr><tr><td><b>Achternaam:</b></td><td> ' + res[0].last_name + '</td></tr><tr><td><b>ID nummer:<b></td><td> ' + res[0].id_number + '</td></tr></table><p><b>Vaccinatie status:</b><br>' + vacStatus + '</p><button class="closeModal">Terug</button>'
                        }
                        else if (res[0].status == 'Vaccinated') {
                            vacStatus = "Volledig gevaccineerd"
                            document.getElementById('myModalcont').innerHTML = '<div><img src="wrong.png"></div><div class="body"><table><tr><td><b>Voornaam:</b></td><td> ' + res[0].first_name + '</td></tr><tr><td><b>Achternaam:</b></td><td> ' + res[0].last_name + '</td></tr><tr><td><b>ID nummer:<b></td><td> ' + res[0].id_number + '</td></tr></table><p><b>Vaccinatie status:</b><br>' + vacStatus + '</p><button class="closeModal">Terug</button>'
                        }
                        else if (res[0].status == 'Vaccinated + Booster') {
                            vacStatus = "volledig gevaccineerd en heeft de " + res[0].manufracturer + " Booster ook genomen"
                            document.getElementById('myModalcont').innerHTML = '<div><img src="wrong.png"></div><table><tr><td><b>Voornaam:</b></td><td> ' + res[0].first_name + '</td></tr><tr><td><b>Achternaam:</b></td><td> ' + res[0].last_name + '</td></tr><tr><td><b>ID nummer:<b></td><td> ' + res[0].id_number + '</td></tr></table><p><b>Vaccinatie status:</b><br>' + vacStatus + '</p><button class="closeModal">Terug</button>'
                        }
                        var button = document.getElementsByClassName("closeModal")[0];
                        button.onclick = function () {
                            modal.style.display = "none";
                        }
                    }

                })
                .catch(error => {
                    console.log('error', error)
                    document.getElementById('myModalcont').innerHTML = '<h1 style="font-size:60px">QRcode is niet geldig<h1><button class="closeModal">Terug</button>'
                    var button = document.getElementsByClassName("closeModal")[0];
                    button.onclick = function () {
                        modal.style.display = "none";
                    }
                });
        },
        (errorMessage) => {
            // parse error, ignore it.
        })
        .catch((err) => {
            // Start failed, handle it.
        });
</script>
<script>
    // Get the modal
    var modal = document.getElementById("myModal");

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>
<script>

    res = [
        {
            "id": 12,
            "first_name": "Denzel",
            "last_name": "Rasidin",
            "birth_date": "2021-11-12",
            "id_number": "fr123",
            "manufracturer": "AstraZeneca",
            "lot_number1": "12345",
            "date1": "2021-11-19",
            "vaccinator1": "denz",
            "lot_number2": null,
            "date2": null,
            "vaccinator2": null,
            "lot_number3": null,
            "date3": null,
            "vaccinator3": null,
            "status": "Vaccinated",
            "qr_code": "generated_qrcodes/fr123.png",
            "created_at": "2021-11-20 00:08:23",
            "updated_at": null
        }
    ]
    modal.style.display = "block";
    console.log(res[0]['status'])

    if (res[0]['status'] == 'afgehandeld') {
        //pcr
    } else {
        //vax
      
       if (res[0].status == 'Vaccinated') {
            vacStatus = "Volledig gevaccineerd"
            // wrong
            // document.getElementById('myModalcontWrong').innerHTML = '<div class="header"><img src="https://team13.app.sr/wrong.png"><p><b>Geen geldige QR-code</b></p></div><div class="body"><p>De bezeker heeft geen geldige negatief testbewijs</p><button class="closeModal">Scan Volgende</button></div>'
            //  document.getElementsByClassName('modal-content')[0].
            // style.visibility = 'hidden';

            //good
            // document.getElementById('myModalcont').innerHTML = '<div class="header"><img src="https://team13.app.sr/right.png"><p><b>Geldige QR-code</b></p></div><div class="body"><table><tr><td><b>Voornaam:</b></td><td>'+res[0].first_name + '</td></tr><tr><td><b>Achternaam:</b></td><td>' + res[0].last_name + '</td></tr><tr><td><b>ID nummer:<b></td><td> ' + res[0].id_number + '</td></tr></table><p><b>Vaccinatie status:</b><br>' + vacStatus + '</p><button class="closeModal">Scan Volgende</button></div>'
            // document.getElementsByClassName('modal-content-wrong')[0].
            // style.visibility = 'hidden';
            document.getElementById('myModalcont').innerHTML ='<div class="header"><img src="https://team13.app.sr/right.png"><p><b>Geldige QR-code</b></p></div><div class="body"><table ><tr><td><b>Voornaam:</b></td><td>'+'Denzel'+'</td></tr><tr><td><b>Achternaam:</b></td><td>'+'Rasidin'+'</td></tr><tr><td><b>ID-nummer:</b></td><td>'+'FR1234'+'</td></tr><tr><tr><td><b>Resultaat:</b></td><td style="color:green;">'+'negatief'+'</td></tr></table><p><b>Geldig tot:</b><br>' + '21-11-2021' + '</p><button class="closeModal">Scan Volgende</button></div>'
            document.getElementsByClassName('modal-content-wrong')[0].
            style.visibility = 'hidden';
        }
       
        var button = document.getElementsByClassName("closeModal")[0];
        button.onclick = function () {
            modal.style.display = "none";
        }
    }

</script>